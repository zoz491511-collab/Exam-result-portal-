<!--
Exam Result Portal (Single-file)
Filename: index.html

What's included:
- A single static HTML file that provides a search UI to check exam results by Roll Number, Name, or Class.
- The page will try to fetch /results.json from the same repo (recommended) and fall back to an embedded sample dataset.
- Admin can upload/replace the dataset using the "Upload results.json" file input (client-side only).

How to deploy (GitHub + Netlify):
1. Create a new GitHub repository (public or private).
2. Add this index.html to the repo root. (Optional) Add a results.json file to the repo root if you want to maintain the data separately.
3. Push the repo to GitHub.
4. Go to Netlify -> Sites -> "Add new site" -> "Import from Git" -> connect your GitHub account -> select the repo -> set "Build command" empty and "Publish directory" to "/" (or leave defaults for a plain static site) -> Deploy site.
5. Netlify will publish a URL. If you later update the repo, Netlify auto-deploys on push.

Notes on results.json format (example):
[
  {
    "roll": "1001",
    "name": "Asha Kumar",
    "class": "10A",
    "marks": { "Math": 88, "English": 76, "Science": 92 },
    "total": 256,
    "percentage": 85.33
  }
]

Security & scaling:
- This single-file solution is suitable for small schools or test scenarios with non-sensitive data. For large datasets or privacy requirements, use a backend (Firebase, Supabase, or a database + API) and protect access.

If you want, I can:
- Create a repository structure for you (multiple files) and provide exact git commands.
- Add CSV import, pagination, or print-ready result cards.
- Integrate with a simple serverless backend for authorized uploads.

-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
async function checkResult() {
  const rollInput = document.getElementById('roll').value.trim();
  const dobInput = document.getElementById('dob').value.trim();
  const outputDiv = document.getElementById('result');

  if (!rollInput || !dobInput) {
    outputDiv.innerHTML = `<p style="color:red;">⚠️ Please enter Roll Number and Date of Birth</p>`;
    return;
  }

  try {
    const response = await fetch('results.json');
    const data = await response.json();

    const student = data.find(
      (s) => s.roll === rollInput && s.dob === dobInput
    );

    if (student) {
      outputDiv.innerHTML = `
        <h3>✅ Result Found</h3>
        <p><strong>Name:</strong> ${student.name}</p>
        <p><strong>Roll No:</strong> ${student.roll}</p>
        <p><strong>Date of Birth:</strong> ${student.dob}</p>
        <p><strong>Marks:</strong> ${Object.entries(student.marks)
          .map(([sub, mark]) => `${sub}: ${mark}`)
          .join(', ')}</p>
        <p><strong>Total:</strong> ${student.total}</p>
        <p><strong>Percentage:</strong> ${student.percentage}%</p>
        <p><strong>Status:</strong> ${
          student.percentage >= 35 ? 'Pass' : 'Fail'
        }</p>
        <button id="pdfBtn">Download PDF</button>
      `;

      document
        .getElementById('pdfBtn')
        .addEventListener('click', () => generatePDF(student));
    } else {
      outputDiv.innerHTML = `<p style="color:red;">❌ No result found. Check Roll Number or DOB.</p>`;
    }
  } catch (error) {
    outputDiv.innerHTML = `<p style="color:red;">⚠️ Error fetching results.json</p>`;
  }
}

function generatePDF(student) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(16);
  doc.text('Exam Result Report Card', 70, 20);
  doc.setFontSize(12);
  doc.text(`Name: ${student.name}`, 20, 40);
  doc.text(`Roll Number: ${student.roll}`, 20, 50);
  doc.text(`Date of Birth: ${student.dob}`, 20, 60);
  doc.text('Marks:', 20, 75);

  let y = 85;
  for (const [subject, mark] of Object.entries(student.marks)) {
    doc.text(`${subject}: ${mark}`, 30, y);
    y += 10;
  }

  doc.text(`Total: ${student.total}`, 20, y + 10);
  doc.text(`Percentage: ${student.percentage}%`, 20, y + 20);
  doc.text(
    `Status: ${student.percentage >= 35 ? 'Pass ✅' : 'Fail ❌'}`,
    20,
    y + 30
  );

  doc.setFontSize(10);
  doc.text(
    `Generated securely for Roll No: ${student.roll}`,
    20,
    y + 50
  );

  doc.save(`${student.roll}_result.pdf`);
}
</script>
