<!--
Exam Result Portal (Single-file)
Filename: index.html

What's included:
- A single static HTML file that provides a search UI to check exam results by Roll Number, Name, or Class.
- The page will try to fetch /results.json from the same repo (recommended) and fall back to an embedded sample dataset.
- Admin can upload/replace the dataset using the "Upload results.json" file input (client-side only).

How to deploy (GitHub + Netlify):
1. Create a new GitHub repository (public or private).
2. Add this index.html to the repo root. (Optional) Add a results.json file to the repo root if you want to maintain the data separately.
3. Push the repo to GitHub.
4. Go to Netlify -> Sites -> "Add new site" -> "Import from Git" -> connect your GitHub account -> select the repo -> set "Build command" empty and "Publish directory" to "/" (or leave defaults for a plain static site) -> Deploy site.
5. Netlify will publish a URL. If you later update the repo, Netlify auto-deploys on push.

Notes on results.json format (example):
[
  {
    "roll": "1001",
    "name": "Asha Kumar",
    "class": "10A",
    "marks": { "Math": 88, "English": 76, "Science": 92 },
    "total": 256,
    "percentage": 85.33
  }
]

Security & scaling:
- This single-file solution is suitable for small schools or test scenarios with non-sensitive data. For large datasets or privacy requirements, use a backend (Firebase, Supabase, or a database + API) and protect access.

If you want, I can:
- Create a repository structure for you (multiple files) and provide exact git commands.
- Add CSV import, pagination, or print-ready result cards.
- Integrate with a simple serverless backend for authorized uploads.

-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exam Result Portal</title>

  <style>
    :root { font-family: 'Inter', system-ui, Arial, sans-serif; }
    body {
      margin: 0;
      background: #f2f4f8;
      color: #111;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 28px;
    }
    .card {
      max-width: 980px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 22px rgba(20, 30, 60, 0.08);
    }
    h1 {
      margin: 0 0 8px;
      font-size: 24px;
      text-align: center;
      color: #2563eb;
    }
    .info {
      text-align: center;
      font-size: 14px;
      color: #475569;
      margin-bottom: 20px;
    }
    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
      margin: 0 auto 20px auto;
    }
    input, button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d8e0ef;
      font-size: 15px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover { background: #1e40af; }
    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #f9fafb;
    }
    #pdfBtn {
      background: #047857;
      margin-top: 12px;
    }
    #pdfBtn:hover { background: #065f46; }
    footer {
      margin-top: 20px;
      text-align: center;
      color: #47413b;
      font-size: 13px;
    }
    .logo {
      display: block;
      margin: 0 auto 15px auto;
      width: 90px;
      border-radius: 12px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #d2e8f0;
      padding: 8px;
      text-align: left;
    }
    th { background-color: #f1f5f9; }
  </style>
</head>

<body>
  <div class="card">
    <img src="https://salmon-michaella-16.tiiny.site" alt="School Logo" class="logo" />
    <h1>Exam Result Portal</h1>
    <div class="info">Enter your Roll Number and Date of Birth to view your result.</div>

    <div class="controls">
      <input id="roll" type="text" placeholder="Enter Roll Number" />
      <input id="dob" type="date" />

      <!-- ✅ Google reCAPTCHA -->
      <div class="g-recaptcha" data-sitekey="6LeP5wYsAAAAAANhXQx7GxFfed5SRya1fGQ7iR5Y"></div>

      <button onclick="checkResult()">Check Result</button>
    </div>

    <div id="result"></div>
    <footer>© 2025 Secure Result Portal — Powered by 47NewsPublic</footer>
  </div>

  <!-- ✅ JS libraries -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <script>
    async function checkResult() {
      const rollInput = document.getElementById('roll').value.trim();
      const dobInput = document.getElementById('dob').value.trim();
      const outputDiv = document.getElementById('result');

      // ✅ Basic validation
      if (!rollInput || !dobInput) {
        outputDiv.innerHTML = '<p style="color:red;">⚠️ Please enter both Roll Number and Date of Birth.</p>';
        return;
      }

      // ✅ CAPTCHA validation
      const captchaResponse = grecaptcha.getResponse();
      if (!captchaResponse) {
        outputDiv.innerHTML = '<p style="color:red;">⚠️ Please verify you are not a robot.</p>';
        return;
      }

      try {
        const response = await fetch('results.json');
        const data = await response.json();
        const student = data.find(s => s.roll === rollInput && s.dob === dobInput);

        if (student) {
          const grade =
            student.percentage >= 75 ? 'A' :
            student.percentage >= 60 ? 'B' :
            student.percentage >= 35 ? 'C' : 'Fail';

          let marksHTML = '<table><tr><th>Subject</th><th>Marks</th></tr>';
          for (const [subject, mark] of Object.entries(student.marks)) {
            marksHTML += `<tr><td>${subject}</td><td>${mark}</td></tr>`;
          }
          marksHTML += '</table>';

          outputDiv.innerHTML = `
            <h3>✅ Result Found</h3>
            <p><strong>Name:</strong> ${student.name}</p>
            <p><strong>Roll No:</strong> ${student.roll}</p>
            <p><strong>Date of Birth:</strong> ${student.dob}</p>
            ${marksHTML}
            <p><strong>Total Marks:</strong> ${student.total}</p>
            <p><strong>Percentage:</strong> ${student.percentage}%</p>
            <p><strong>Grade:</strong> ${grade}</p>
            <button id="pdfBtn">Download PDF Report</button>
          `;

          document.getElementById('pdfBtn').onclick = () => generatePDF(student, grade);

          // Reset CAPTCHA after success
          grecaptcha.reset();
        } else {
          outputDiv.innerHTML = '<p style="color:red;">❌ No result found. Please check Roll No or DOB.</p>';
          grecaptcha.reset();
        }
      } catch (error) {
        outputDiv.innerHTML = '<p style="color:red;">⚠️ Error fetching results.json file. Please check your setup.</p>';
        grecaptcha.reset();
      }
    }

    function generatePDF(student, grade) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(18);
      doc.text('ABC International School', 105, 20, null, null, 'center');
      doc.setFontSize(12);
      doc.text('Official Report Card', 105, 28, null, null, 'center');

      // watermark
      doc.setFontSize(50);
      doc.setTextColor(240);
      doc.text('VERIFIED', 105, 150, null, null, 'center');
      doc.setTextColor(0);

      doc.setFontSize(12);
      doc.text(`Name: ${student.name}`, 20, 50);
      doc.text(`Roll No: ${student.roll}`, 20, 60);
      doc.text(`Date of Birth: ${student.dob}`, 20, 70);

      let y = 85;
      doc.text('Subject-wise Marks:', 20, y); y += 8;
      for (const [subject, mark] of Object.entries(student.marks)) {
        doc.text(`${subject}: ${mark}`, 30, y);
        y += 8;
      }

      y += 5;
      doc.text(`Total Marks: ${student.total}`, 20, y); y += 8;
      doc.text(`Percentage: ${student.percentage}%`, 20, y); y += 8;
      doc.text(`Grade: ${grade}`, 20, y); y += 8;
      doc.text(`Status: ${grade === 'Fail' ? '❌ Failed' : '✅ Passed'}`, 20, y); y += 15;

      doc.line(20, y, 190, y);
      y += 10;
      doc.text("Principal's Signature: ________________", 20, y);

      doc.setFontSize(10);
      doc.text('Generated securely by Exam Result Portal', 105, 280, null, null, 'center');

      doc.save(`${student.roll}_Result.pdf`);
    }
  </script>
</body>
</html>
